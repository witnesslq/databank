------------------------
-- 1.在 3代 BOSS 库执行
------------------------
--==============================================================
-- Table: DATABANK.TBL_ROLE_ALLOW_COLUMN
--==============================================================

CREATE TABLE DATABANK.TBL_ROLE_ALLOW_COLUMN
(
  ID           BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  ROLE_ID      BIGINT       NOT NULL,
  DS_ID        BIGINT       NOT NULL,
  SCHEMANAME   VARCHAR(200) NOT NULL,
  TABLENAME    VARCHAR(200) NOT NULL,
  ALLOW_COLUMN VARCHAR(250) NOT NULL
);
COMMENT ON TABLE DATABANK.TBL_ROLE_ALLOW_COLUMN IS '允许的列信息表';
COMMENT ON COLUMN DATABANK.TBL_ROLE_ALLOW_COLUMN.ID IS '主键';
COMMENT ON COLUMN DATABANK.TBL_ROLE_ALLOW_COLUMN.ROLE_ID IS '角色ID';
COMMENT ON COLUMN DATABANK.TBL_ROLE_ALLOW_COLUMN.DS_ID IS '数据源ID';
COMMENT ON COLUMN DATABANK.TBL_ROLE_ALLOW_COLUMN.SCHEMANAME IS 'schema名';
COMMENT ON COLUMN DATABANK.TBL_ROLE_ALLOW_COLUMN.TABLENAME IS '表名';
COMMENT ON COLUMN DATABANK.TBL_ROLE_ALLOW_COLUMN.ALLOW_COLUMN IS '允许的列';

GRANT INSERT, UPDATE, DELETE, SELECT ON TABLE DATABANK.TBL_ROLE_ALLOW_COLUMN TO USER 数据银行读写用户;
GRANT SELECT ON TABLE  DATABANK.TBL_ROLE_ALLOW_COLUMN  TO USER 数据银行只读用户;

--===================================================================
-- Index: DATABANK.ROLE_ID_ALLOWCOLUMN_index
--===================================================================
CREATE INDEX DATABANK.ROLE_ID_ALLOWCOLUMN_index ON DATABANK.TBL_ROLE_ALLOW_COLUMN(ROLE_ID);
--===================================================================
-- Index:  DATABANK.DS_ID_ALLOWCOLUMN_index
--===================================================================
CREATE INDEX DATABANK.DS_ID_ALLOWCOLUMN_index ON DATABANK.TBL_ROLE_ALLOW_COLUMN(DS_ID);

--==============================================================
-- Table: DATABANK.TBL_ROLE_NOTALLOW_COLUMN
--==============================================================
CREATE TABLE DATABANK.TBL_ROLE_NOTALLOW_COLUMN
(
  ID           BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  ROLE_ID         BIGINT       NOT NULL,
  DS_ID           BIGINT       NOT NULL,
  SCHEMANAME      VARCHAR(200) NOT NULL,
  TABLENAME       VARCHAR(200) NOT NULL,
  NOTALLOW_COLUMN VARCHAR(250) NOT NULL
);
COMMENT ON TABLE DATABANK.TBL_ROLE_NOTALLOW_COLUMN IS '不允许的列信息表';
COMMENT ON COLUMN DATABANK.TBL_ROLE_NOTALLOW_COLUMN.ID IS '主键';
COMMENT ON COLUMN DATABANK.TBL_ROLE_NOTALLOW_COLUMN.ROLE_ID IS '角色ID';
COMMENT ON COLUMN DATABANK.TBL_ROLE_NOTALLOW_COLUMN.DS_ID IS '数据源ID';
COMMENT ON COLUMN DATABANK.TBL_ROLE_NOTALLOW_COLUMN.SCHEMANAME IS 'schema名';
COMMENT ON COLUMN DATABANK.TBL_ROLE_NOTALLOW_COLUMN.TABLENAME IS '表名';
COMMENT ON COLUMN DATABANK.TBL_ROLE_NOTALLOW_COLUMN.NOTALLOW_COLUMN IS '不允许的列';

GRANT INSERT, UPDATE, DELETE, SELECT ON TABLE DATABANK.TBL_ROLE_NOTALLOW_COLUMN TO USER 数据银行读写用户;
GRANT SELECT ON TABLE  DATABANK.TBL_ROLE_NOTALLOW_COLUMN  TO USER 数据银行只读用户;

--=====================================================================
-- Index: DATABANK.ROLE_ID_NOTALLOWCOLUMN_index
--=====================================================================
CREATE INDEX DATABANK.ROLE_ID_NOTALLOWCOLUMN_index ON  DATABANK.TBL_ROLE_NOTALLOW_COLUMN(ROLE_ID);
--=====================================================================
-- Index: DATABANK.DS_ID_NOTALLOWCOLUMN_index
--=====================================================================
CREATE INDEX DATABANK.DS_ID_NOTALLOWCOLUMN_index ON  DATABANK.TBL_ROLE_NOTALLOW_COLUMN(DS_ID);

--==============================================================
-- Table: DATABANK.TBL_ROLE_ALLOW_TABLE
--==============================================================
CREATE TABLE DATABANK.TBL_ROLE_ALLOW_TABLE
(
  ID           BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  ROLE_ID    BIGINT       NOT NULL,
  DS_ID      BIGINT       NOT NULL,
  SCHEMANAME VARCHAR(200) NOT NULL,
  TABLENAME  VARCHAR(200) NOT NULL
);
COMMENT ON TABLE DATABANK.TBL_ROLE_ALLOW_TABLE IS '允许的表';
COMMENT ON COLUMN DATABANK.TBL_ROLE_ALLOW_TABLE.ID IS '主键';
COMMENT ON COLUMN DATABANK.TBL_ROLE_ALLOW_TABLE.ROLE_ID IS '角色ID';
COMMENT ON COLUMN DATABANK.TBL_ROLE_ALLOW_TABLE.DS_ID IS '数据源ID';
COMMENT ON COLUMN DATABANK.TBL_ROLE_ALLOW_TABLE.SCHEMANAME IS 'schema名';
COMMENT ON COLUMN DATABANK.TBL_ROLE_ALLOW_TABLE.TABLENAME IS '表名';

GRANT INSERT, UPDATE, DELETE, SELECT ON TABLE DATABANK.TBL_ROLE_ALLOW_TABLE TO USER 数据银行读写用户;
GRANT SELECT ON TABLE  DATABANK.TBL_ROLE_ALLOW_TABLE  TO USER 数据银行只读用户;


--=====================================================================
-- Index: DATABANK.ROLE_ID_ALLOWTABLE_index
--=====================================================================
CREATE INDEX DATABANK.ROLE_ID_ALLOWTABLE_index ON  DATABANK.TBL_ROLE_ALLOW_TABLE(ROLE_ID);
--=====================================================================
-- Index: DATABANK.DS_ID_ALLOWTABLE_index
--=====================================================================
CREATE INDEX DATABANK.DS_ID_ALLOWTABLE_index ON  DATABANK.TBL_ROLE_ALLOW_TABLE(DS_ID);

--==============================================================
-- Table: DATABANK.TBL_ROLE_NOTALLOW_TABLE
--==============================================================
CREATE TABLE DATABANK.TBL_ROLE_NOTALLOW_TABLE
(
  ID           BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  ROLE_ID    BIGINT       NOT NULL,
  DS_ID      BIGINT       NOT NULL,
  SCHEMANAME VARCHAR(200) NOT NULL,
  TABLENAME  VARCHAR(200) NOT NULL
);

GRANT INSERT, UPDATE, DELETE, SELECT ON TABLE DATABANK.TBL_ROLE_NOTALLOW_TABLE TO USER 数据银行读写用户;
GRANT SELECT ON TABLE  DATABANK.TBL_ROLE_NOTALLOW_TABLE  TO USER 数据银行只读用户;

COMMENT ON TABLE DATABANK.TBL_ROLE_NOTALLOW_TABLE IS '不允许的表';
COMMENT ON COLUMN DATABANK.TBL_ROLE_NOTALLOW_TABLE.ID IS '主键';
COMMENT ON COLUMN DATABANK.TBL_ROLE_NOTALLOW_TABLE.ROLE_ID IS '角色ID';
COMMENT ON COLUMN DATABANK.TBL_ROLE_NOTALLOW_TABLE.DS_ID IS '数据源ID';
COMMENT ON COLUMN DATABANK.TBL_ROLE_NOTALLOW_TABLE.SCHEMANAME IS 'schema';
COMMENT ON COLUMN DATABANK.TBL_ROLE_NOTALLOW_TABLE.TABLENAME IS '表名';

--=====================================================================
-- Index: DATABANK.ROLE_ID_NOTALLOWTABLE_index
--=====================================================================
CREATE INDEX DATABANK.ROLE_ID_NOTALLOWTABLE_index ON  DATABANK.TBL_ROLE_NOTALLOW_TABLE(ROLE_ID);
--=====================================================================
-- Index: DATABANK.DS_ID_NOTALLOWTABLE_index
--=====================================================================
CREATE INDEX DATABANK.DS_ID_NOTALLOWTABLE_index ON  DATABANK.TBL_ROLE_NOTALLOW_TABLE(DS_ID);


--==============================================================
-- Table: DATABANK.TBL_DB_USER_DATASOURCE
--==============================================================
CREATE TABLE DATABANK.TBL_DB_USER_DATASOURCE (
  ID           BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  USER_ID        BIGINT    NOT NULL,
  DS_ID          BIGINT    NOT NULL,
  START_DATETIME TIMESTAMP NOT NULL,
  END_DATETIME   TIMESTAMP NOT NULL
);
GRANT INSERT, UPDATE, DELETE, SELECT ON TABLE DATABANK.TBL_DB_USER_DATASOURCE TO USER 数据银行读写用户;
GRANT SELECT ON TABLE  DATABANK.TBL_DB_USER_DATASOURCE  TO USER 数据银行只读用户;


COMMENT ON TABLE DATABANK.TBL_DB_USER_DATASOURCE IS '用户申请数据源表';
COMMENT ON COLUMN DATABANK.TBL_DB_USER_DATASOURCE.ID IS '主键';
COMMENT ON COLUMN DATABANK.TBL_DB_USER_DATASOURCE.USER_ID IS '用户ID';
COMMENT ON COLUMN DATABANK.TBL_DB_USER_DATASOURCE.DS_ID IS '数据源ID';
COMMENT ON COLUMN DATABANK.TBL_DB_USER_DATASOURCE.START_DATETIME IS '开始时间';
COMMENT ON COLUMN DATABANK.TBL_DB_USER_DATASOURCE.END_DATETIME IS '结束时间';

--=====================================================================
-- Index: DATABANK.USER_ID_DATASOURCE_index
--=====================================================================
CREATE INDEX DATABANK.USER_ID_DATASOURCE_index ON  DATABANK.TBL_DB_USER_DATASOURCE(USER_ID);
--=====================================================================
-- Index: DATABANK.DS_ID_DATASOURCE_index
--=====================================================================
CREATE INDEX DATABANK.DS_ID_DATASOURCE_index ON  DATABANK.TBL_DB_USER_DATASOURCE(DS_ID);

--==============================================================
-- Table: DATABANK.TBL_DS_APPLY
--==============================================================
CREATE TABLE DATABANK.TBL_DS_APPLY (
  ID                     BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  USER_ID                BIGINT      NOT NULL,
  DS_ID                  BIGINT      NOT NULL,
  APPLY_REASON           VARCHAR(1024),
  APPLY_STATUS           VARCHAR(40) NOT NULL,
  REVIEW_NAME            VARCHAR(80),
  REVIEW_MESSAGE         VARCHAR(1024),
  APPLY_USE_DATETIME     TIMESTAMP   NOT NULL,
  ALLOW_USE_DATETIME     TIMESTAMP ,
  CREATED_DATETIME       TIMESTAMP          DEFAULT CURRENT_TIMESTAMP,
  LAST_MODIFIED_DATETIME TIMESTAMP          DEFAULT CURRENT_TIMESTAMP
);

GRANT INSERT, UPDATE, DELETE, SELECT ON TABLE DATABANK.TBL_DS_APPLY TO USER 数据银行读写用户;
GRANT SELECT ON TABLE  DATABANK.TBL_DS_APPLY  TO USER 数据银行只读用户;

COMMENT ON TABLE DATABANK.TBL_DS_APPLY IS '用户数据源申请表';
COMMENT ON COLUMN DATABANK.TBL_DS_APPLY.ID IS '主键';
COMMENT ON COLUMN DATABANK.TBL_DS_APPLY.USER_ID IS '用户ID';
COMMENT ON COLUMN DATABANK.TBL_DS_APPLY.DS_ID IS '数据源ID';
COMMENT ON COLUMN DATABANK.TBL_DS_APPLY.APPLY_REASON IS '申请理由';
COMMENT ON COLUMN DATABANK.TBL_DS_APPLY.APPLY_STATUS IS '申请状态';
COMMENT ON COLUMN DATABANK.TBL_DS_APPLY.REVIEW_NAME IS '审核人姓名';
COMMENT ON COLUMN DATABANK.TBL_DS_APPLY.REVIEW_MESSAGE IS '审核信息';
COMMENT ON COLUMN DATABANK.TBL_DS_APPLY.APPLY_USE_DATETIME IS '申请使用时间';
COMMENT ON COLUMN DATABANK.TBL_DS_APPLY.ALLOW_USE_DATETIME IS '允许使用时间';
COMMENT ON COLUMN DATABANK.TBL_DS_APPLY.CREATED_DATETIME IS '创建时间';
COMMENT ON COLUMN DATABANK.TBL_DS_APPLY.LAST_MODIFIED_DATETIME IS '最后修改时间';

--=====================================================================
-- Index: DATABANK.ID_DS_index
--=====================================================================
CREATE INDEX DATABANK.ID_DS_index ON  DATABANK.TBL_DS_APPLY(ID);
--=====================================================================
-- Index: DATABANK.USER_ID_DS_index
--=====================================================================
CREATE INDEX DATABANK.USER_ID_DS_index ON  DATABANK.TBL_DS_APPLY(USER_ID);
--=====================================================================
-- Index: DATABANK.DS_ID_DS_index
--=====================================================================
CREATE INDEX DATABANK.DS_ID_DS_index ON  DATABANK.TBL_DS_APPLY(DS_ID);



--=====================================================================
-- 表中新增加列
--=====================================================================

ALTER TABLE DATABANK.TBL_ROLE_NOTALLOW_COLUMN   ADD   COLUMN  END_DATETIME  TIMESTAMP;
ALTER TABLE DATABANK.TBL_ROLE_ALLOW_COLUMN      ADD   COLUMN  END_DATETIME  TIMESTAMP;
ALTER TABLE DATABANK.TBL_ROLE_ALLOW_TABLE       ADD   COLUMN  END_DATETIME  TIMESTAMP;
ALTER TABLE DATABANK.TBL_ROLE_NOTALLOW_TABLE    ADD   COLUMN  END_DATETIME  TIMESTAMP;
ALTER TABLE DATABANK.TBL_ROLE_DATASOURCE        ADD   COLUMN  END_DATETIME  TIMESTAMP;
ALTER TABLE DATABANK.TBL_DB_ROLE                ADD   COLUMN  USER_ID       BIGINT;

ALTER TABLE DATABANK.TBL_SQL_MSG ADD COLUMN DIALECT VARCHAR(20) WITH DEFAULT 'DB2';


--=====================================================================
-- TBL_DB_USER_ROLE表中新增加列 FLAG
--=====================================================================
ALTER TABLE DATABANK.TBL_DB_USER_ROLE ADD COLUMN FLAG VARCHAR(20);

--=====================================================================
-- TBL_DS_APPLY表中新增加列
--=====================================================================
ALTER TABLE DATABANK.TBL_DS_APPLY ADD COLUMN  ALLOW_TABLE VARCHAR(250);
ALTER TABLE DATABANK.TBL_DS_APPLY ADD COLUMN  NOTALLOW_TABLE VARCHAR(250);
ALTER TABLE DATABANK.TBL_DS_APPLY ADD COLUMN  ALLOW_COLUMN VARCHAR(250);
ALTER TABLE DATABANK.TBL_DS_APPLY ADD COLUMN  NOTALLOW_COLUMN VARCHAR(250);
